---
title: "Lab-grades"
author: "Paula de Miguel SÃ¡nchez"
format: html
---

Link to my GitHub Repository: https://github.com/paulademiguel/lab-grades.git

```{r}
here::i_am("lab-grades.Rproj")

library(here)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(knitr)
```

### Question 1

```{r}
courses <- read_csv(here("courses.csv"))
```

### Question 2

```{r}
courses |>
  arrange(course) |>
  rename(
    `Course name`     = course,
    identifier        = course_id,
    `number of grades` = nb_grades
  ) |>
  knitr::kable()
```
### Question 3
```{r}
students <- read_csv(here("students.csv"))
students <- students |>
  mutate(
    birth_date = as.Date(birth_date),
    sex= factor(sex),
    group = factor(group),
    id = as.integer(id)
  )
class(students$birth_date)
class(students$sex)
class(students$group)
class(students$id)
```
The `birth_date` column of the `students`data frame is of class Date

The `sex`column is correctly identified as a factor

### Question 4
```{r}
grades <- read_delim(
  here("grades.csv"),
  delim = "|",
  na = "unknown"
)
```
### Question 5
```{r}
students |>
  count(group) |>
  ggplot(aes(x=group, y = n)) +
  geom_col(fill = "lavenderblush2") +
  theme_minimal() +
  labs(
    title = "Number of students per group", 
    x = "Group",
    y = "Count"
  )
```
The bar plot shows the number of students that are in each group

### Question 6
```{r}
students |>
  ggplot(aes(x = group, fill = sex)) +
  geom_bar(position = "fill") +
  theme_minimal() +
  labs(
    title = "Gender balance by group",
    x = "Group",
    y = "Proportion"
  )
```
### Question 7
```{r}
students <- students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year") |> round() 
    )
students |>
  ggplot(aes(x=age)) +
  geom_histogram(binwidth=1, fill = "orchid4", color = "white") +
  theme_minimal() +
  labs(
    title = "Distribution of students ages", 
    x = "Age",
    y= "Count"
  )
  
```

The histogram below displays the age distribution of the students

### Question 8
```{r}
students |>
  group_by(group) |>
  summarise(
    median_age = round(median(age, na.rm = TRUE))
  ) |>
   knitr::kable()
```

### Question 9
```{r}
students |>
  group_by(group) |>
  slice_max(order_by = age, n= 1) |>
  select(id, sex, age, group) |>
  arrange(desc(age)) |>
  knitr:: kable()
  
```

### Question 10
```{r}
n_grades <-grades |>
  filter(!is.na(grade))|>
  nrow()
n_grades
```
The data set contains 43882 grades

```{r}
courses |>
  arrange(course) |>
  knitr::kable()
```
I just did this because the merge dataset (avg_by_group) I just created was empty and I didn't understand why until I realised that maybe I was not naming properly the courses, so I did it to know the accurate names.

### Question 11
```{r}
necromancy_id <- courses |>
  filter(course == "Necromancy and Spirit Summoning") |>
  pull(course_id)

necromancy_id

grades_necro <- grades |>
  filter(course_id == necromancy_id) |>
  inner_join(students, by = "id")

avg_by_group <- grades_necro |>
  summarise(
    avg_grade = mean(grade, na.rm = TRUE),
    .by = group
  )
avg_by_group |>
  ggplot(aes(x = group, y = avg_grade)) +
  geom_col(fill = "olivedrab") +
  theme_minimal() +
  labs(
    title = "Average grade in Necromancy and  Spirit Summoning by group",
   x = "Group",
    y = "Average grade"
  )
```
### Question 12
```{r}
grades_mod <- grades |>
  inner_join(courses, by = "course_id")
grades_mod |>
  ggplot(aes(x = factor(module), y = grade)) +
  geom_boxplot(fill = "lightskyblue1") +
  theme_minimal() +
  labs(
    title = "Distribution of grades by module",
    x = "Module",
    y = "Grade"
  )
```

